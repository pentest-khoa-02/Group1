<!DOCTYPE html>
<html>
<head>
  <link href="/style.css" rel="stylesheet">
  <title>Exploit Server</title>
</head>
<body>
  <section class="maincontainer is-page">
    <div class="container">
      <h3>Craft a response</h3>
      <form id="feedbackForm" action="/exploit" method="POST" style="max-width: unset">
        <p>
          URL: <span id="fullUrl"></span>
        </p>
        <label>
          HTTPS
          <input type="checkbox" style="width: auto" name="urlIsHttps" checked="" onchange="updateFullUrl()">
        </label>
        <label>File:</label>
        <input required="" type="text" name="responseFile" value="<%= responseFile %>" oninput="updateFullUrl()">
        <label>Head:</label>
        <textarea required="" rows="12" cols="300" name="responseHead"><%= responseHead %></textarea>
        <label>Body:</label>
        <textarea required="" rows="12" cols="300" style="white-space: no-wrap; overflow-x: scroll" name="responseBody"><%= responseBody %></textarea>
        <button class="button" name="formAction" value="STORE" type="submit">Store</button>
        <button class="button" name="formAction" value="VIEW_EXPLOIT" type="submit">View exploit</button>
        <button class="button" name="formAction" value="ACCESS_LOG" type="submit">Access log</button>
      </form>
    </div>
  </section>
  <script>
    const convertFormToJson = (node) => Array.from(node.querySelectorAll('input, textarea, select'))
      .reduce((acc, cur) => {
        acc[cur.name] = cur.type === 'checkbox' ?
          cur.checked :
          cur.value;
        return acc;
      }, {})
    const updateFullUrl = () => {
      const o = convertFormToJson(document.getElementById('feedbackForm'));
      if (location.port == 80, 443) {
        document.getElementById('fullUrl').innerText = `${o.urlIsHttps ? 'https' : 'http'}://${location.hostname}${o.responseFile}`;
      } else {
        document.getElementById('fullUrl').innerText = `${o.urlIsHttps ? 'https' : 'http'}://${location.hostname}:${location.port}${o.responseFile}`;
      }
    }
    updateFullUrl();
  </script>
  <br>  
  <footer>Code lấy trên mạng, Inspired by Portswigger</footer>
</body>
</html>